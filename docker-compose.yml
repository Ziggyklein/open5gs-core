services:
  mongo:
    image: mongo:4.4
    container_name: mongo
    restart: unless-stopped
    networks: [open5gs]
    volumes:
      - mongo-data:/data/db

  webui:
    image: gradiant/open5gs-webui:2.7.2
    container_name: webui
    restart: unless-stopped
    networks: [open5gs]
    depends_on: [mongo]
    ports:
      - "3000:3000"

  nrf:
    image: gradiant/open5gs:2.7.2
    container_name: nrf
    restart: unless-stopped
    networks: [open5gs]
    volumes:
      - ./config:/etc/open5gs:ro
    command: ["open5gs-nrfd"]

  scp:
    image: gradiant/open5gs:2.7.2
    container_name: scp
    restart: unless-stopped
    networks: [open5gs]
    volumes:
      - ./config:/etc/open5gs:ro
    command: ["open5gs-scpd"]
    depends_on: [nrf]

  amf:
    image: gradiant/open5gs:2.7.2
    container_name: amf
    restart: unless-stopped
    networks: [open5gs]
    volumes:
      - ./config:/etc/open5gs:ro
    command: ["open5gs-amfd"]
    depends_on: [nrf, scp]
    # gNB -> AMF (NGAP over SCTP)
    ports:
      - "38412:38412/sctp"

  ausf:
    image: gradiant/open5gs:2.7.2
    container_name: ausf
    restart: unless-stopped
    networks: [open5gs]
    volumes:
      - ./config:/etc/open5gs:ro
    command: ["open5gs-ausfd"]
    depends_on: [nrf, scp, mongo]

  udm:
    image: gradiant/open5gs:2.7.2
    container_name: udm
    restart: unless-stopped
    networks: [open5gs]
    volumes:
      - ./config:/etc/open5gs:ro
    command: ["open5gs-udmd"]
    depends_on: [nrf, scp, mongo]

  udr:
    image: gradiant/open5gs:2.7.2
    container_name: udr
    restart: unless-stopped
    networks: [open5gs]
    volumes:
      - ./config:/etc/open5gs:ro
    command: ["open5gs-udrd"]
    depends_on: [nrf, scp, mongo]

  pcf:
    image: gradiant/open5gs:2.7.2
    container_name: pcf
    restart: unless-stopped
    networks: [open5gs]
    volumes:
      - ./config:/etc/open5gs:ro
    command: ["open5gs-pcfd"]
    depends_on: [nrf, scp, mongo]

  nssf:
    image: gradiant/open5gs:2.7.2
    container_name: nssf
    restart: unless-stopped
    networks: [open5gs]
    volumes:
      - ./config:/etc/open5gs:ro
    command: ["open5gs-nssfd"]
    depends_on: [nrf, scp, mongo]

  bsf:
    image: gradiant/open5gs:2.7.2
    container_name: bsf
    restart: unless-stopped
    networks: [open5gs]
    volumes:
      - ./config:/etc/open5gs:ro
    command: ["open5gs-bsfd"]
    depends_on: [nrf, scp, mongo]

  smf:
    image: gradiant/open5gs:2.7.2
    container_name: smf
    restart: unless-stopped
    networks: [open5gs]
    volumes:
      - ./config:/etc/open5gs:ro
    command: ["open5gs-smfd"]
    depends_on: [nrf, scp, mongo, upf]
  
  upf:
    image: gradiant/open5gs:2.7.2
    container_name: upf
    restart: unless-stopped
    networks: [open5gs]
    volumes:
      - ./config:/etc/open5gs:ro
    command: ["open5gs-upfd"]
    privileged: true
    cap_add:
      - NET_ADMIN
      - SYS_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    sysctls:
      - net.ipv4.ip_forward=1
    ports:
      - "2152:2152/udp"

networks:
  open5gs:
    name: open5gs

volumes:
  mongo-data:
